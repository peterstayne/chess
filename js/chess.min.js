window.console=window.console?window.console:{log:function(){}};
for(var $doc=$(document),$board=$("#board"),$movelist=$("#movelist"),game={algebraicSquares:{ranks:"hgfedcba".split(""),symbols:{},numbers:[]},playerSettings:["Player","thinkMover_1_3"],gamemoves:[],gameOn:!0,coords:[],sq:0},i=0;8>i;i++)for(var r=8;r;r--)game.algebraicSquares.symbols[game.algebraicSquares.ranks[r-1]+(8-i)]=game.sq,game.algebraicSquares.numbers[game.sq]=game.algebraicSquares.ranks[r-1]+(8-i),game.coords[game.sq]=[9-r,i+1],game.sq++;
game.ucpieces={p:"&#9823;",n:"&#9822;",b:"&#9821;",r:"&#9820;",q:"&#9819;",k:"&#9818;",P:"&#9817;",N:"&#9816;",B:"&#9815;",R:"&#9814;",Q:"&#9813;",K:"&#9812;"};
var BLACK_PAWN=1,BLACK_KNIGHT=2,BLACK_BISHOP=3,BLACK_ROOK=4,BLACK_QUEEN=5,BLACK_KING=6,WHITE_PAWN=7,WHITE_KNIGHT=8,WHITE_BISHOP=9,WHITE_ROOK=10,WHITE_QUEEN=11,WHITE_KING=12,BLACK_PAWN_A="p",BLACK_KNIGHT_A="n",BLACK_BISHOP_A="b",BLACK_ROOK_A="r",BLACK_QUEEN_A="q",BLACK_KING_A="k",WHITE_PAWN_A="P",WHITE_KNIGHT_A="N",WHITE_BISHOP_A="B",WHITE_ROOK_A="R",WHITE_QUEEN_A="Q",WHITE_KING_A="K";game.engines={Player:{name:"Player",displayName:"Player",getMove:function(){return null}}};
game.players=["Player","randomMover"];game.pieces={symbols:{p:1,n:2,b:3,r:4,q:5,k:6,P:7,N:8,B:9,R:10,Q:11,K:12},numbers:" pnbrqkPNBRQK".split(""),hashNumbers:"epnbrqkPNBRQK".split(""),WorB:[0,1,1,1,1,1,1,2,2,2,2,2,2]};game.node=function(){this.position=[];this.castle={k:!1,q:!1,K:!1,Q:!1};this.drawClock=0;this.moveNumber=1;this.enpassantSquare="-";this.score=0;this.move=!0};function clone(a){var c={},f;for(f in a)a.hasOwnProperty(f)&&(c[f]=a[f]);return c}
function fastCloneNode(a){for(var c={castle:{K:a.castle.K,Q:a.castle.Q,k:a.castle.k,q:a.castle.q},drawClock:a.drawClock,enpassantSquare:a.enpassantSquare,move:a.move,moveNumber:a.moveNumber,score:a.score,position:Array(64)},f=0;64>f;f++)c.position[f]=a.position[f];return c}function isWorE(a){return 0===a||6<a}function isB(a){return a&&7>a}
game.moveGen=function(a){var c,f=a.move,e=a.position,g=[],h=0,d=1,m,n,l,k;m=f?function(a){return 7>e[a]}:function(a){return 0===e[a]||6<e[a]};for(var b=0;64>b;b++)if(h++,9===h&&(d++,h=1),c=e[b],!(0===c||f&&7>c||!f&&6<c))switch(c){case WHITE_PAWN:2<d&&0===e[b-8]&&g.push([b,b-8]);4===d?(1<h&&b-9===a.enpassantSquare&&g.push([b,b-9,"ep-capture",b-1]),8>h&&b-7===a.enpassantSquare&&g.push([b,b-7,"ep-capture",b+1])):2===d&&0===e[b-8]?(g.push([b,b-8,"promote",WHITE_KNIGHT]),g.push([b,b-8,"promote",WHITE_BISHOP]),
g.push([b,b-8,"promote",WHITE_ROOK]),g.push([b,b-8,"promote",WHITE_QUEEN])):7===d&&0===e[b-16]&&0===e[b-8]&&g.push([b,b-16,"ep-enable",b-8]);8!==h&&0<e[b-7]&&7>e[b-7]&&(2!==d?g.push([b,b-7]):(g.push([b,b-7,"promote",WHITE_KNIGHT]),g.push([b,b-7,"promote",WHITE_BISHOP]),g.push([b,b-7,"promote",WHITE_ROOK]),g.push([b,b-7,"promote",WHITE_QUEEN])));1!==h&&0<e[b-9]&&7>e[b-9]&&(2!==d?g.push([b,b-9]):(g.push([b,b-9,"promote",WHITE_KNIGHT]),g.push([b,b-9,"promote",WHITE_BISHOP]),g.push([b,b-9,"promote",WHITE_ROOK]),
g.push([b,b-9,"promote",WHITE_QUEEN])));break;case BLACK_PAWN:7>d&&0===e[b+8]&&g.push([b,b+8]);5===d?(1!==h&&b+9===a.enpassantSquare&&g.push([b,b+9,"ep-capture",b+1]),8!==h&&b+7===a.enpassantSquare&&g.push([b,b+7,"ep-capture",b-1])):7===d&&0===e[b+8]?(g.push([b,b+8,"promote",BLACK_KNIGHT]),g.push([b,b+8,"promote",BLACK_BISHOP]),g.push([b,b+8,"promote",BLACK_ROOK]),g.push([b,b+8,"promote",BLACK_QUEEN])):2===d&&0===e[b+16]&&0===e[b+8]&&g.push([b,b+16,"ep-enable",b+8]);1<h&&6<e[b+7]&&(7!==d?g.push([b,
b+7]):(g.push([b,b+7,"promote",BLACK_KNIGHT]),g.push([b,b+7,"promote",BLACK_BISHOP]),g.push([b,b+7,"promote",BLACK_ROOK]),g.push([b,b+7,"promote",BLACK_QUEEN])));8>h&&6<e[b+9]&&(7!==d?g.push([b,b+9]):(g.push([b,b+9,"promote",BLACK_KNIGHT]),g.push([b,b+9,"promote",BLACK_BISHOP]),g.push([b,b+9,"promote",BLACK_ROOK]),g.push([b,b+9,"promote",BLACK_QUEEN])));break;case WHITE_KNIGHT:case BLACK_KNIGHT:1<d&&(2<d&&(1<h&&m(b-17)&&g.push([b,b-17]),8>h&&m(b-15)&&g.push([b,b-15])),7>h&&m(b-6)&&g.push([b,b-6]),
2<h&&m(b-10)&&g.push([b,b-10]));8>d&&(7>d&&(1<h&&m(b+15)&&g.push([b,b+15]),8>h&&m(b+17)&&g.push([b,b+17])),7>h&&m(b+10)&&g.push([b,b+10]),2<h&&m(b+6)&&g.push([b,b+6]));break;case WHITE_BISHOP:case BLACK_BISHOP:c=b;l=h-1;n=d-1;for(k=!1;0<l&&0<n&&!k;)c-=9,--l,--n,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;l=h+1;n=d-1;for(k=!1;9>l&&0<n&&!k;)c-=7,l+=1,--n,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;l=h-1;n=d+1;for(k=!1;0<l&&9>n&&!k;)c+=7,--l,n+=1,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;l=h+1;n=d+1;for(k=
!1;9>l&&9>n&&!k;)c+=9,l+=1,n+=1,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);break;case WHITE_ROOK:case BLACK_ROOK:c=b;l=h-1;for(k=!1;l&&!k;)--c,--l,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;l=h+1;for(k=!1;9>l&&!k;)c+=1,l+=1,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;n=d-1;for(k=!1;n&&!k;)c-=8,--n,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;n=d+1;for(k=!1;9>n&&!k;)c+=8,n+=1,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);break;case WHITE_QUEEN:case BLACK_QUEEN:c=b;l=h-1;n=d-1;for(k=!1;0<l&&0<n&&!k;)c-=9,--l,--n,m(c)&&g.push([b,
c]),0!==e[c]&&(k=!0);c=b;l=h+1;n=d-1;for(k=!1;9>l&&0<n&&!k;)c-=7,l+=1,--n,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;l=h-1;n=d+1;for(k=!1;0<l&&9>n&&!k;)c+=7,--l,n+=1,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;l=h+1;n=d+1;for(k=!1;9>l&&9>n&&!k;)c+=9,l+=1,n+=1,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;l=h-1;for(k=!1;l&&!k;)--c,--l,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;l=h+1;for(k=!1;9>l&&!k;)c+=1,l+=1,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);c=b;n=d-1;for(k=!1;n&&!k;)c-=8,--n,m(c)&&g.push([b,c]),0!==e[c]&&
(k=!0);c=b;n=d+1;for(k=!1;9>n&&!k;)c+=8,n+=1,m(c)&&g.push([b,c]),0!==e[c]&&(k=!0);break;case WHITE_KING:!a.castle.K||0!==e[61]||0!==e[62]||squareInCheck(a,60,!0)||squareInCheck(a,61,!0)||squareInCheck(a,62,!0)||g.push([b,b+2,"castle",WHITE_KING_A]);!a.castle.Q||0!==e[57]||0!==e[58]||0!==e[59]||squareInCheck(a,58,!0)||squareInCheck(a,59,!0)||squareInCheck(a,60,!0)||g.push([b,b-2,"castle",WHITE_QUEEN_A]);1<h&&(7>e[b-1]&&g.push([b,b-1]),1<d&&7>e[b-9]&&g.push([b,b-9]),8>d&&7>e[b+7]&&g.push([b,b+7]));
8>d&&7>e[b+8]&&g.push([b,b+8]);1<d&&7>e[b-8]&&g.push([b,b-8]);8>h&&(7>e[b+1]&&g.push([b,b+1]),1<d&&7>e[b-7]&&g.push([b,b-7]),8>d&&7>e[b+9]&&g.push([b,b+9]));break;case BLACK_KING:!a.castle.k||0!==e[5]||0!==e[6]||squareInCheck(a,4,!1)||squareInCheck(a,5,!1)||squareInCheck(a,6,!1)||g.push([b,b+2,"castle",BLACK_KING_A]),!a.castle.q||0!==e[1]||0!==e[2]||0!==e[3]||squareInCheck(a,2,!1)||squareInCheck(a,3,!1)||squareInCheck(a,4,!1)||g.push([b,b-2,"castle",BLACK_QUEEN_A]),1<h&&((0===e[b-1]||6<e[b-1])&&g.push([b,
b-1]),1<d&&(0===e[b-9]||6<e[b-9])&&g.push([b,b-9]),8>d&&(0===e[b+7]||6<e[b+7])&&g.push([b,b+7])),1<d&&(0===e[b-8]||6<e[b-9])&&g.push([b,b-8]),8>d&&(0===e[b+8]||6<e[b+8])&&g.push([b,b+8]),8>h&&((0===e[b+1]||e[b+1])&&g.push([b,b+1]),1<d&&(0===e[b-7]||6<e[b-7])&&g.push([b,b-7]),8>d&&(0===e[b-9]||6<e[b-9])&&g.push([b,b+9]))}for(d=g.length;d--;)h=fastCloneNode(a),kingInCheck(doMove(h,g[d]),f)&&g.splice(d,1);return g};
var parsefen=function(a){var c=new game.node;a=a.split(" ");var f=0,e=0,g=0,h,d;a[0].split("/").forEach(function(a){for(var l=e=0;l<a.length;l++)if(g=8*f+e,h=a[l],d=h.charCodeAt(),47<d&&58>d){for(var k=0;k<+h;k++)c.position[g+k]=0;e+=+h}else c.position[g]=game.pieces.symbols[h],e++;f++});c.move="w"===a[1].toLowerCase();for(var m=a[2].length;m--;)a[2][m]in{k:"",K:"",q:"",Q:""}&&(c.castle[a[2][m]]=!0);c.enpassantSquare="-"!==a[3]&&"undefined"!==typeof game.algebraicSquares.symbols[a[3]]?game.algebraicSquares.symbols[a[3]]:
-1;a[4]===+a[4]&&(c.drawClock=+a[4]);a[5]===+a[5]&&(c.moveNumber=+a[5]);return c},outputfen=function(a){for(var c=-1,f,e="",g=0;8>g;g++){for(var h=f=0;8>h;h++)c++,a.position[c]&&f&&(e+=f,f=0),a.position[c]?e+=game.pieces.numbers[a.position[c]]:f++;f&&(e+=f);7>g&&(e+="/")}var e=e+(a.move?" w":" b"),c="",d;for(d in a.castle)a.castle[d]&&(c+=d);e=""!==c?e+(" "+c):e+" -";e=-1<a.enpassantSquare?e+(" "+game.algebraicSquares.numbers[a.enpassantSquare]):e+" -";return e+=" "+a.drawClock+" "+a.moveNumber},
makePositionString=function(a){for(var c="p",f=0;64>f;f+=1)c+=game.pieces.hashNumbers[a.position[f]];c+=a.move?"w":"b";c+=a.castle.K?"1":"0";c+=a.castle.Q?"1":"0";c+=a.castle.k?"1":"0";return c+=a.castle.q?"1":"0"},squareInCheck=function(a,c,f){var e=game.coords[c][0],g=game.coords[c][1],h,d,m,n,l,k,b,u,q;f?(h=BLACK_PAWN,d=BLACK_KNIGHT,m=BLACK_BISHOP,n=BLACK_ROOK,l=BLACK_QUEEN,k=BLACK_KING):(h=WHITE_PAWN,d=WHITE_KNIGHT,m=WHITE_BISHOP,n=WHITE_ROOK,l=WHITE_QUEEN,k=WHITE_KING);if(7>e&&1<g&&a.position[c-
6]===d||7>e&&8>g&&a.position[c+10]===d||8>e&&2<g&&a.position[c-15]===d||8>e&&7>g&&a.position[c+17]===d||2<e&&1<g&&a.position[c-10]===d||2<e&&8>g&&a.position[c+6]===d||1<e&&2<g&&a.position[c-17]===d||1<e&&7>g&&a.position[c+15]===d)return!0;d=c;b=e;for(q=!1;--b&&!q;){d--;if(a.position[d]===l||a.position[d]===n||b===e-1&&a.position[d]===k)return!0;+a.position[d]&&(q=!0)}d=c;b=e;for(q=!1;++b&&9>b&&!q;){d++;if(a.position[d]===l||a.position[d]===n||b===e+1&&a.position[d]===k)return!0;+a.position[d]&&(q=
!0)}d=c;u=g;for(q=!1;--u&&!q;){d-=8;if(a.position[d]===l||a.position[d]===n||u===g-1&&a.position[d]===k)return!0;+a.position[d]&&(q=!0)}d=c;u=g;for(q=!1;++u&&9>u&&!q;){d+=8;if(a.position[d]===l||a.position[d]===n||u===g+1&&a.position[d]===k)return!0;+a.position[d]&&(q=!0)}d=c;b=e;u=g;for(q=!1;--b&&--u&&!q;){d-=9;if(a.position[d]===l||a.position[d]===m||b===e-1&&u===g-1&&(a.position[d]===k||f&&a.position[d]===h))return!0;+a.position[d]&&(q=!0)}d=c;b=e;u=g;for(q=!1;--b&&++u&&9>u&&!q;){d+=7;if(a.position[d]===
l||a.position[d]===m||b===e-1&&u===g+1&&(a.position[d]===k||!f&&a.position[d]===h))return!0;+a.position[d]&&(q=!0)}d=c;b=e;u=g;for(q=!1;++b&&9>b&&--u&&!q;){d-=7;if(a.position[d]===l||a.position[d]===m||b===e+1&&u===g-1&&(a.position[d]===k||f&&a.position[d]===h))return!0;+a.position[d]&&(q=!0)}d=c;b=e;u=g;for(q=!1;++b&&9>b&&++u&&9>u&&!q;){d+=9;if(a.position[d]===l||a.position[d]===m||b===e+1&&u===g+1&&(a.position[d]===k||!f&&a.position[d]===h))return!0;+a.position[d]&&(q=!0)}return!1},kingInCheck=
function(a,c){for(var f=64;f--;)if(!c&&a.position[f]===BLACK_KING||c&&a.position[f]===WHITE_KING)return squareInCheck(a,f,c);return!1},doMove=function(a,c){1===a.position[c[0]]||7===a.position[c[0]]||a.position[c[1]]?a.drawClock=0:a.drawClock++;6===a.position[c[0]]&&(a.castle.k=!1,a.castle.q=!1);12===a.position[c[0]]&&(a.castle.K=!1,a.castle.Q=!1);0===c[0]&&4===a.position[c[0]]&&(a.castle.q=!1);7===c[0]&&4===a.position[c[0]]&&(a.castle.k=!1);56===c[0]&&10===a.position[c[0]]&&(a.castle.Q=!1);63===
c[0]&&10===a.position[c[0]]&&(a.castle.K=!1);a.position[c[1]]=a.position[c[0]];a.position[c[0]]=0;a.enpassantSquare=-1;if(2<c.length)switch(c[2]){case "promote":a.position[c[1]]=+c[3];break;case "ep-enable":a.enpassantSquare=c[3];break;case "ep-capture":a.position[c[3]]=0;break;case "castle":switch(c[3]){case BLACK_KING_A:a.position[5]=a.position[7];a.position[7]=0;break;case BLACK_QUEEN_A:a.position[3]=a.position[0];a.position[0]=0;break;case WHITE_KING_A:a.position[61]=a.position[63];a.position[63]=
0;break;case WHITE_QUEEN_A:a.position[59]=a.position[56],a.position[56]=0}}a.move||a.moveNumber++;a.move=!a.move;return a};
game.requestMove=function(){if(!game.gameOn)return!1;var a=$board.data("node"),c=game.engines[game.playerSettings[a.move?0:1]];if("Player"!==c.name&&"function"===typeof c.getMove){var f=game.engines[game.playerSettings[a.move?0:1]].getMove(a);a.position[f[0]]===WHITE_KING&&2===Math.abs(f[1]-f[0])&&3>f.length&&(60===f[0]&&62===f[1]&&(f[2]="castle",f[3]="K"),60===f[0]&&58===f[1]&&(f[2]="castle",f[3]="Q"));a.position[f[0]]===BLACK_KING&&2===Math.abs(f[1]-f[0])&&3>f.length&&(4===f[0]&&6===f[1]&&(f[2]=
"castle",f[3]="k"),4===f[0]&&2===f[1]&&(f[2]="castle",f[3]="q"));doMoveUI(f);setTimeout(function(){game.pushMove(a,f)},300)}};
game.pushMove=function(a,c){"undefined"===typeof game.gamemoves[a.moveNumber]&&(game.gamemoves[a.moveNumber]=[]);var f=a.move?0:1,e=c?getMoveString(a,c):"...",g=fastCloneNode(a),g=doMove(g,c);game.gamemoves[a.moveNumber][f]={fen:outputfen(g),movestring:e};$("#fen").val(outputfen(a));f||"undefined"===typeof game.gamemoves[a.moveNumber][1]||game.gamemoves[a.moveNumber].splice(1,1);game.gamemoves.splice(a.moveNumber+1,game.gamemoves.length-a.moveNumber);c&&(a=doMove(a,c));$board.data("node",a);updateBoard();
game.gameOn&&(a.move&&"Player"!==game.playerSettings[0]||!a.move&&"Player"!==game.playerSettings[1])&&setTimeout(game.requestMove,0)};game.resetGame=function(){var a;game.gameOn=!0;a=arguments.length?arguments[0]:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";$(".square").text(" ");game.gamemoves=[];a=parsefen(a);$board.data("node",a);game.pushMove(a,!1);$(".piece").remove();redrawBoard()};
var getMoveString=function(a,c){var f="";if(2<c.length&&"castle"===c[2]&&(c[3]===BLACK_KING_A||c[3]===WHITE_KING_A))f+='<span class="sq1" data-square="'+c[0]+'">o-o</span>';else if(2<c.length&&"castle"===c[2]&&(c[3]===BLACK_QUEEN_A||c[3]==WHITE_QUEEN_A))f+='<span class="sq1" data-square="'+c[0]+'">o-o-o</span>';else if(f+=game.ucpieces[game.pieces.numbers[a.position[c[0]]]],f+='<span class="sq1" data-square="'+c[0]+'">'+game.algebraicSquares.numbers[c[0]]+"</span>",f=a.position[c[1]]||2<c.length&&
"ep-capture"===c[3]?f+"x":f+"-",f+='<span class="sq2" data-square="'+c[1]+'">'+game.algebraicSquares.numbers[c[1]]+"</span>",2<c.length)switch(c[2]){case "promote":f+="="+game.ucpieces[game.pieces.numbers[c[3]]];break;case "ep-capture":f+="ep"}return f+"</li>"},updateMoveList=function(){if(!game.gameOn)return!1;var a=$board.data("node"),c=game.moveGen(a),f="";if(49<a.drawClock||!c.length)return game.gameOn=!1,c.length?f="Draw via 50-move rule.":kingInCheck(a,a.move)?(f="Checkmate!! ",f+=a.move?"Black":
"White",f+=" wins!!"):f="Draw by stalemate!!",$("#possible-moves .button-action").attr("disabled","disabled"),alert(f),f="<p>"+f+"</p>",$movelist.html(f),!1;game.gameOn=!0;$("#possible-moves .button-action").removeAttr("disabled");f="<ul>";c.forEach(function(c,g){f+='<li data-movegenid="'+g+'">'+getMoveString(a,c)+"</li>"});f+="</ul>";$movelist.html(f);return!0},updateGameMoveList=function(){var a="<ul>";game.gamemoves.forEach(function(c,f){a+='<li class="movenumber">'+f+".</li>";"undefined"!==typeof c[0]&&
(a+='<li class="gm-white move-item" data-fen="'+c[0].fen+'">'+c[0].movestring+"</li>");"undefined"!==typeof c[1]&&(a+='<li class="gm-black move-item" data-fen="'+c[1].fen+'">'+c[1].movestring+"</li>")});a+="</ul>";$("#game-moves").html(a)},redrawBoard=function(){var a=$board.data("node").position,c=64;$(".square");for(var f=7,e=7,g="",h,d;c--;)a[c]&&(h=game.pieces.numbers[a[c]],d=h.toLowerCase()===h?"pblack":"pwhite",g+='<span id="piece-'+c+'" class="piece '+d+'" style="left: '+59*e+"px; top: "+59*
f+'px">'+(" "!==h?game.ucpieces[h]:"&nbsp;")+"</span>"),e--,-1===e&&(f--,e=7);$("#pieceboard").html(g)},doMoveUI=function(a){var c=a[1]>>3,f=a[1]-8*c;$("#piece-"+a[1]).remove();$("#piece-"+a[0]).attr("id","piece-"+a[1]).css({left:59*f,top:59*c});2<a.length&&("castle"===a[2]?(a[3]===WHITE_KING_A&&doMoveUI([63,61]),a[3]===WHITE_QUEEN_A&&doMoveUI([56,59]),a[3]===BLACK_KING_A&&doMoveUI([7,5]),a[3]===BLACK_QUEEN_A&&doMoveUI([0,3])):"promote"===a[2]?$("#piece-"+a[1]).html(game.ucpieces[game.pieces.numbers[a[3]]]):
"ep-capture"===a[2]&&$("#piece-"+a[3]).remove())},updateBoard=function(){var a=$board.data("node");"undefined"===typeof game.gamemoves[a.moveNumber]&&(game.gamemoves[a.moveNumber]=[]);var c=-1===+a.enpassantSquare?"-":a.enpassantSquare,f="";-1<c&&(c=game.algebraicSquares.numbers[c]);for(var e in a.castle)f=a.castle[e]?f+(e+" "):f+"- ";$(".fromsq").removeClass("fromsq");a.move?$("#turn").html('<p class="white">White\'s Turn</p>'):$("#turn").html('<p class="black">Black\'s Turn</p>');$("#movenumber").html('<p class="info">Move number: '+
a.moveNumber+"</p>");$("#drawclock").html('<p class="info">Draw clock: '+a.drawClock+"</p>");$("#enpassant").html('<p class="info">En passant square: '+c+"</p>");$("#castle").html('<p class="info">Castles: '+f+"</p>");$movelist.find("ul").html("");game.gameOn=updateMoveList();updateGameMoveList();return game.gameOn};
$doc.ready(function(){for(var a="",c="",f=!0,e=0,g=0,h=0;64>h;h++)a+='<div id="square'+h+'" style="left: '+59*g+"px; top: "+59*e+'px" class="square '+(f?"white":"black")+'"> </div>',c+='<div style="left: '+59*g+"px; top: "+59*e+'px" class="csquare '+(f?"white":"black")+'"> </div>',g++,8===g&&(e++,g=0),(h+1)/8!==~~((h+1)/8)&&(f=!f);$("#checkerboard").html(c);$board.html(a);var d=a="";Object.keys(game.engines).forEach(function(a){d+='<option value="'+a+'">'+game.engines[a].displayName+"</option>"});
$(".player-dd").html(d);$("#player1").val(game.playerSettings[0]);$("#player2").val(game.playerSettings[1]);game.resetGame()});$("#submitfen").on("click",function(){game.resetGame($("#fen").val())});$doc.on("click",".cancel-modal",function(){$(".modal").css("display","none")});
$doc.on("click",".promote-button",function(){var a=$(this),c=a.parents(".modal").eq(0);if(!c.length)return!1;var f=c.data("fromsq"),c=c.data("tosq"),a=[f,c,"promote",a.data().piece],f=$board.data("node");game.pushMove(f,a);doMoveUI(a);$(".modal").css("display","none")});$doc.on("click","#possible-moves li",function(){if(!game.gameOn)return!1;var a=$board.data("node"),c=game.moveGen(a)[$(this).data().movegenid];game.pushMove(a,c);doMoveUI(c)});
$doc.on("click","#game-moves li.move-item",function(){var a=$(this).attr("data-fen"),c=parsefen(a);$("#fen").val(a);$board.data("node",c);updateBoard();redrawBoard()});
$doc.on("click",".square",function(){if(!game.gameOn)return!1;$(".modal").css("display","none");if($(".fromsq").length){var a=$board.data("node"),c=game.moveGen(a),f=+$(".fromsq").eq(0).attr("id").replace("square",""),e=+this.id.replace("square",""),g=0,h;for(h in c)if(c[h][0]===f&&c[h][1]===e){g=h;break}if(g){"promote"!==c[g][2]&&doMoveUI(c[g]);if(2<c[g].length&&"promote"===c[g][2])return h=$(this).position(),0>(h.left-=150)&&(h.left=0),0>(h.top-=50)&&(h.top=0),a.move?$("#promote-white").css({display:"block"}).data({tosq:e,
fromsq:f}):$("#promote-black").css({display:"block"}).data({tosq:e,fromsq:f}),!0;setTimeout(function(){game.pushMove(a,c[g])},300)}else $(".fromsq").removeClass("fromsq"),$(this).addClass("fromsq")}else $(this).addClass("fromsq")});
$("#player-settings-container select").on("change",function(){"player1"===this.name&&(game.playerSettings[0]=$(this).val());"player2"===this.name&&(game.playerSettings[1]=$(this).val());if(!game.gameOn)return!1;var a=$board.data("node");(a.move&&"Player"!==game.playerSettings[0]||!a.move&&"Player"!==game.playerSettings[1])&&game.requestMove()});$("#reset-game").on("click",function(){game.resetGame()});
game.engines.randomMover={name:"randomMover",displayName:"randomMover",getMove:function(a){a=game.moveGen(a);return a[~~(Math.random()*a.length)]}};game.engines.thinkMover_1_0={name:"thinkMover_1_0",displayName:"thinkMover 1.0",getMove:function(a){function c(a){var c=0;a.forEach(function(a){c+=g[a]});return c}function f(a,e){h+=1;var g=[],l=0,k=game.moveGen(a);if(k.length)k.forEach(function(b,k){var h=!1,v=$.extend(!0,{},a);a.position[b[1]]&&(h=!0);v=doMove(v,b);h=e?f(v,e-1):2===e&&h?f(v,e):~~c(v.position);g.length?!1===v.move&&h>l||!0===v.move&&h<l?(l=h,g=[k]):l!==h&&g.length||g.push(k):(g=[k],l=h)});else return 2===e?null:a.move?kingInCheck(a,
!0)?-9999:0:kingInCheck(a,!1)?9999:0;return 2!==e?l:g=k[g[~~(Math.random()*g.length)]]}var e=(new Date).getTime(),g=[0,-1,-3,-3,-5,-9,0,1,3,3,5,9,0],h=0;a=f(a,2);e=(new Date).getTime()-e;console.log(this.name,"nodes searched: "+h,"time taken: "+e+"ms","nodes/second: "+~~(h/(e/1E3)));return a}};game.engines.thinkMover_1_1={name:"thinkMover_1_1",displayName:"thinkMover 1.1",getMove:function(a){function c(a,c){var e=0;a.forEach(function(a,c){if(!a)return!0;var b,d;b=c>>3;d=c-(b<<3);e+=a===BLACK_PAWN?-1+-.1*b:a===WHITE_PAWN?1+.1*(7-b):a===BLACK_KNIGHT?0===d||7===d||0===b||7===b?-2.5:-3:a===WHITE_KNIGHT?0===d||7===d||0===b||7===b?2.5:3:g[a]});return e}function f(a,e,g){h+=1;var l=[],k=0,b=game.moveGen(a);if(b.length){if(b.forEach(function(b,h){var v=!1;if(b[1]===g)v=!0;else if(g)return!0;var p=
fastCloneNode(a),p=doMove(p,b),v=e?f(p,e-1,!1):v?f(p,e,b[1]):c(p.position);!1===v&&(v=c(p.position));l.length?!1===p.move&&v>k||!0===p.move&&v<k?(k=v,l=[h]):k!==v&&l.length||l.push(h):(l=[h],k=v)}),!l.length)return!1}else return 3===e?null:a.move?kingInCheck(a,!0)?-9999:0:kingInCheck(a,!1)?9999:0;return 3!==e?k:1===l.length?b[l[0]]:b[l[~~(Math.random()*l.length)]]}var e=(new Date).getTime(),g=[0,-1,-3,-3,-5,-9,0,1,3,3,5,9,0],h=0;a=f(a,3,!1);e=(new Date).getTime()-e;console.log(this.name,"nodes searched: "+
h,"time taken: "+e+"ms","nodes/second: "+~~(h/(e/1E3)));return a}};game.engines.thinkMover_1_2={name:"thinkMover_1_2",displayName:"thinkMover 1.2",getMove:function(a){function c(a){for(var c=0,d,b,e,f=0,m=0,p=[0,0,0,0,0,0,0,0],w=[0,0,0,0,0,0,0,0],t=0;64>t;t+=1)d=a[t],0!==d&&(b=t>>3,e=t-(b<<3),6<d?f+=g[d]:m+=g[d],d===WHITE_PAWN&&(p[e]+=1),d===BLACK_PAWN&&(w[e]+=1));for(var B=0,C=0,t=0;8>t;t+=1)0<p[t]&&(p[t-1]||p[t+1]||(B+=.25),1!==p[t]&&(B+=.35)),0<w[t]&&(w[t-1]||w[t+1]||(C+=.25),1!==w[t]&&(C+=.35));for(t=0;64>t;t+=1)d=a[t],0!==d&&(b=t>>3,e=t-(b<<3),d=d===BLACK_PAWN?
-1-b*h[e]:d===WHITE_PAWN?1+(7-b)*h[e]:d===BLACK_KNIGHT?0===b?-2.65:0===e||7===e?-2.8:-3:d===WHITE_KNIGHT?7===b?2.65:0===e||7===e?2.8:3:d===BLACK_BISHOP?2===t||5===t?-2.8:-3.07:d===WHITE_BISHOP?58===t||61===t?2.8:3.07:d===BLACK_ROOK?0===w[e]?0===p[e]?-5.52:-5.32:-5:d===WHITE_ROOK?0===p[e]?0===w[e]?5.52:5.32:5:d===BLACK_KING?22<f?-3-(.06*Math.abs(b-4)+.06*Math.abs(e-4)):-3+(.03*Math.abs(b-4)+.03*Math.abs(e-4)):d===WHITE_KING?22<m?3+(.06*Math.abs(b-4)+.06*Math.abs(e-4)):3-(.03*Math.abs(b-4)+.03*Math.abs(e-
4)):g[d],c+=d);return c=c-B+C}function f(a,e,g){d+=1;var b=[],h=0,q=game.moveGen(a),v=q.length,p,w;if(3===e&&(p=makePositionString(a),m[p])){a=0;e=m[p][0][0];for(g=~~(100*Math.random());e<g;)a+=1,e+=m[p][a][0];return[m[p][a][1],m[p][a][2]]}if(0!==v){for(var t=0;t<v;t+=1){themove=q[t];w=!1;if(themove[1]===g)w=!0;else if(g)continue;p=fastCloneNode(a);p=doMove(p,themove);w=e?f(p,e-1,!1):w?f(p,e,themove[1]):c(p.position);!1===w&&(w=c(p.position));b.length?!1===p.move&&w>h||!0===p.move&&w<h?(h=w,b=[t]):
h!==w&&b.length||b.push(t):(b=[t],h=w)}if(!b.length)return!1}else return 3===e?null:a.move?kingInCheck(a,!0)?-9999:0:kingInCheck(a,!1)?9999:0;if(3!==e)return h;"undefined"===typeof q[b[0]]&&console.log(q,b);return q[b[0]]}var e=(new Date).getTime(),g=[0,-1,-3,-3.1,-5,-9,0,1,3,3.1,5,9,0],h=[.11,.12,.13,.16,.17,.08,.1,.1],d=0,m={prnbqkberppeeppppeeepeneeeeeeeeeeeeeNPeeeeeNeeeeePPPeePPPReBQKBeRb1111:[[50,8,16],[30,14,22],[20,1,18]],prnbqkberppeeppppeeepeneeeeeeeeeeeeeNPeeeeeeeeeeePPPeePPPRNBQKBeRw1111:[[100,
57,42]],prnbqkbnrppeeppppeeepeeeeeeeeeeeeeeeNPeeeeeeeeeeePPPeePPPRNBQKBeRb1111:[[100,6,21]],prnbqkbnrppeeppppeeepeeeeeeeeeeeeeeepPeeeeeeeeNeePPPeePPPRNBQKBeRw1111:[[100,45,35]],prnbqkberppppppppeeeeeneeeeeeeeeeeePeeeeeeeNeeeeePPePPPPPReBQKBNRb1111:[[50,14,22],[30,12,20],[20,10,26]],prnbqkberppppppppeeeeeneeeeeeeeeeeePeeeeeeeeeeeeePPePPPPPRNBQKBNRw1111:[[70,57,42],[15,54,46],[15,62,45]],prnbqkbnrppppppppeeeeeeeeeeeeeeeeeePeeeeeeeeeeeeePPePPPPPRNBQKBNRb1111:[[40,6,21],[35,12,28],[15,12,20],[10,10,26]],
prnbqkbnrppepepppeeeepeeeeeeeeeeeeeeNPeeeeeeeeeeePPPeePPPRNBQKBeRb1111:[[40,8,16],[35,6,21],[25,1,18]],prnbqkbnrppepepppeeeepeeeeeeeeeeeeeepPeeeeeeeeNeePPPeePPPRNBQKBeRw1111:[[100,45,35]],prnbqkbnrppepepppeeeepeeeeepeeeeeeeePPeeeeeeeeNeePPPeePPPRNBQKBeRb1111:[[100,26,35]],prnbqkbnrppepepppeeeepeeeeepeeeeeeeeePeeeeeeeeNeePPPPePPPRNBQKBeRw1111:[[80,51,35],[7,50,42],[7,57,42],[6,51,43]],prnbqkbnrppeeepppeepepeeeeeepeeeeeePPeeeeeeNeeNeePPeePPPPReBQKBeRb1111:[[40,6,21],[40,27,34],[20,13,29]],prnbqkbnrppeeepppeepepeeeeeepeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRw1111:[[35,
62,45],[35,52,44],[15,34,27],[15,52,36]],prnbqkberpppeepppeeeepneeeeepeeBeeePPeeeeeeNeeeeePPeePPPPReeQKBNRb1111:[[65,5,12],[35,1,11]],prnbqkberpppeepppeeeepneeeeepeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRw1111:[[55,58,30],[25,34,27],[20,62,45]],prnbqkbnrpppeepppeeeepeeeeeepeeeeeePPeeeeeeeeeeeePPeePPPPRNBQKBNRw1111:[[65,57,42],[35,62,45]],prnbekbnrpppeppppeeeeeeeeqeeeeeeeeeePeeeeeeNeeeeePPPeePPPReBQKBNRb1111:[[65,6,21],[35,10,18]],prnbekbnrpppeppppeeeeeeeeqeeeeeeeeeeeeeeeeeNeeeeePPPPePPPReBQKBNRw1111:[[75,
51,35],[15,62,45],[10,61,34]],prnbekbnrpppeppppeeeeeeeeeeeqeeeeeeeeeeeeeeNeeeeePPPPePPPReBQKBNRb1111:[[100,27,24]],prnbekbnrpppeppppeeeeeeeeeeeqeeeeeeeeeeeeeeeeeeeePPPPePPPRNBQKBNRw1111:[[100,57,42]],prnbqkbnrpppeppppeeeeeeeeeeePeeeeeeeeeeeeeeeeeeeePPPPePPPRNBQKBNRb1111:[[60,3,27],[40,6,21]],prnbqkbnrpppeppppeeeeeeeeeeepeeeeeeeePeeeeeeeeeeePPPPePPPRNBQKBNRw1111:[[100,36,27]],prnbqkeerpppeppbpeeepenpeeeeeeeeeeePPPeeeeeNeeNeePPeeePPPReBQKBeRb1111:[[100,4,6]],prnbqkeerpppeppbpeeepenpeeeeeeeeeeePPPeeeeeNeeeeePPeeePPPReBQKBNRw1111:[[40,
62,45],[35,53,45],[25,61,52]],prnbqkeerppppppbpeeeeenpeeeeeeeeeeePPPeeeeeNeeeeePPeeePPPReBQKBNRb1111:[[85,11,19],[15,4,6]],prnbqkeerppppppbpeeeeenpeeeeeeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRw1111:[[85,52,36],[15,62,45]],prnbqkberppppppepeeeeenpeeeeeeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRb1111:[[75,5,14],[25,11,27]],prnbqkberppppppepeeeeenpeeeeeeeeeeePPeeeeeeeeeeeePPeePPPPRNBQKBNRw1111:[[100,57,42]],prnbqkberppppppppeeeeeneeeeeeeeeeeePeeeeeeeeeeNeePPePPPPPRNBQKBeRb1111:[[45,14,22],[35,12,20],[20,10,26]],
prnbqkberppppppppeeeeeneeeeeeeeeeeeeeeeeeeeeeeNeePPPPPPPPRNBQKBeRw1111:[[60,50,34],[30,54,46],[10,51,35]],prnbqkbnrppppppppeeeeeeeeeeeeeeeeeeeeeeeeeeeeeNeePPPPPPPPRNBQKBeRb1111:[[60,6,21],[30,11,27],[10,10,26]],prnbqkbnrpppeepppeeeepeeeeeepeeeeeeePPeeeeeeeeeeePPPeePPPRNBQKBNRw1111:[[40,57,42],[35,57,51],[15,36,28],[10,36,27]],prnbqkbnrppppepppeeeepeeeeeeeeeeeeeePPeeeeeeeeeeePPPeePPPRNBQKBNRb1111:[[100,11,27]],prnbqkbnrppppepppeeeepeeeeeeeeeeeeeeePeeeeeeeeeeePPPPePPPRNBQKBNRw1111:[[100,51,35]],prnbqkbnrpppeppppeeeeeeeeeeepeeeeeeePeeeeeeeeeeeePPPePPPPRNBQKBNRw1111:[[65,
50,34],[35,62,45]],prebqkeereepebppppenpeneeepeepeeeeeeePeeeeBeeeNeePPPPePPPRNBQReKew0011:[[100,50,42]],prebqkeereeppbppppeneeneeepeepeeeeeeePeeeeBeeeNeePPPPePPPRNBQReKeb0011:[[60,11,19],[40,60,62]],prebqkeereeppbppppeneeneeepeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQReKew0011:[[100,9,25]],prebqkeerepppbppppeneeneeeeeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQeRKew0011:[[100,61,60]],prebqkberepppeppppeneeneeeeeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQeRKeb0011:[[80,5,12],[20,9,25]],prebqkberepppeppppeneeneeeeeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQKeeRw1111:[[100,
60,62]],prebqkbnrepppeppppeneeeeeeeeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQKeeRb1111:[[90,6,21],[10,11,19]],prebqkberpppeepppeenpeneeeBeepeeeeeeePeeeeePPeNeePPeeePPPRNBQKeeRb1111:[[35,14,22],[33,5,12],[32,2,11]],prebqkberpppeepppeenpeneeeBeepeeeeeeePeeeeeePeNeePPPeePPPRNBQKeeRw1111:[[55,50,42],[45,60,62]],prebqkberppppepppeeneeneeeBeepeeeeeeePeeeeeePeNeePPPeePPPRNBQKeeRb1111:[[50,11,19],[50,5,26]],prebqkberppppepppeeneeneeeBeepeeeeeeePeeeeeeeeNeePPPPePPPRNBQKeeRw1111:[[75,60,62],[25,51,43]],prnbqkbnrpppeepppeeeepeeeeeepeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRb1111:[[70,
6,21],[30,10,18]],prnbqkbnrpppeppppeeeeeeeeeeeeeeeeeepPeeeeeeeeeeeePPeePPPPRNBQKBNRw1111:[[70,57,42],[30,62,45]],prnbqkbnrpppeppppeeeeeeeeeeepeeeeeePPeeeeeeeeeeeePPeePPPPRNBQKBNRb1111:[[40,12,20],[40,10,18],[20,27,34]],prebqkbnrppppepppeeneeeeeeeeeeeeeeeepPeeeeeeeeNeePPPeePPPRNBQKBeRw1111:[[100,45,35]],prebqkeerppppepppeeneeneeeebepeeeeeBPPeeeeePeeNeePPeeePPPRNBQKeeRb1111:[[100,28,35]],prebqkeerppppepppeeneeneeeebepeeeeeBePeeeeePeeNeePPePePPPRNBQKeeRw1111:[[60,51,35],[40,51,43]],prebqkenrppppepppeeneeeeeeebepeeeeeBePeeeeePeeNeePPePePPPRNBQKeeRb1111:[[100,
6,21]],prebqkenrppppepppeeneeeeeeebepeeeeeBePeeeeeeeeNeePPPPePPPRNBQKeeRw1111:[[50,50,42],[20,51,43],[15,60,62],[15,57,42]],prebqkbnrppppepppeeneeeeeeeeepeeeeeBePeeeeeeeeNeePPPPePPPRNBQKeeRb1111:[[60,5,26],[40,6,21]],prebqkbnrppppepppeeneeeeeeeeepeeeeeePPeeeeeeeeNeePPPeePPPRNBQKBeRb1111:[[100,28,35]],prnbqkberppppppppeeeeeneeeeeeeeeeeePPeeeeeeeeeeeePPeePPPPRNBQKBNRb1111:[[45,12,20],[35,14,22],[20,10,26]],prnbqkberppppppppeeeeeneeeeeeeeeeeeePeeeeeeeeeeeePPPePPPPRNBQKBNRw1111:[[60,50,34],[40,62,45]],
prnbqkbnrppppppppeeeeeeeeeeeeeeeeeeePeeeeeeeeeeeePPPePPPPRNBQKBNRb1111:[[60,6,21],[40,11,27]],prebqkbnrppepppppeeneeeeeeepeeeeeeeePPeeeeeeeeNeePPPeePPPRNBQKBeRb1111:[[100,26,35]],prnbqkbnrppeeppppeeepeeeeeepeeeeeeeePPeeeeeeeeNeePPPeePPPRNBQKBeRb1111:[[100,26,35]],prnbqkbnrppeeppppeeepeeeeeepeeeeeeeeePeeeeeeeeNeePPPPePPPRNBQKBeRw1111:[[90,51,35],[10,61,25]],prnbqkbnrppepppppeeeeeeeeeepeeeeeeeeePeeeeeeeeNeePPPPePPPRNBQKBeRb1111:[[45,11,19],[40,1,18],[15,12,20]],prnbqkbnrppepppppeeeeeeeeeepeeeeeeeeePeeeeeeeeeeePPPPePPPRNBQKBNRw1111:[[90,
62,45],[5,57,42],[3,50,42],[2,51,35]],prebqkbnrepppeppppeneeeeeeBeepeeeeeeePeeeeeeeeNeePPPPePPPRNBQKeeRw1111:[[86,25,32],[14,25,18]],prnbqkbnrppppppppeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeePPPPPPPPRNBQKBNRw1111:[[45,52,36],[40,51,35],[10,62,45],[8,50,34],[5,54,46],[2,49,41]],prnbqkbnrppppppppeeeeeeeeeeeeeeeeeeeePeeeeeeeeeeePPPPePPPRNBQKBNRb1111:[[50,10,26],[35,12,28],[9,12,20],[4,10,18],[2,11,19]],prnbqkbnrppppepppeeeeeeeeeeeepeeeeeeePeeeeeeeeeeePPPPePPPRNBQKBNRw1111:[[88,62,45],[6,57,42],[6,53,37]],prnbqkbnrppppepppeeeeeeeeeeeepeeeeeeePeeeeeeeeNeePPPPePPPRNBQKBeRb1111:[[95,
1,18],[5,6,21]],prebqkbnrppppepppeeneeeeeeeeepeeeeeeePeeeeeeeeNeePPPPePPPRNBQKBeRw1111:[[70,61,25],[20,61,34],[10,51,35]],prebqkbnrppppepppeeneeeeeeBeepeeeeeeePeeeeeeeeNeePPPPePPPRNBQKeeRb1111:[[86,8,16],[10,6,21],[4,13,29]]};a=f(a,3,!1);e=(new Date).getTime()-e;console.log(this.name,"nodes searched: "+d,"time taken: "+e+"ms","nodes/second: "+~~(d/(e/1E3)));return a}};game.engines.thinkMover_1_3={name:"thinkMover_1_3",displayName:"thinkMover 1.3 (test)",getMove:function(a){function c(a){var c=0,d,e,f,h,x,D=0,E=0,y=[0,0,0,0,0,0,0,0],z=[0,0,0,0,0,0,0,0],A=[];for(x=0;64>x;x++)0!==(d=a[x])&&(e=x>>3,e=x-(e<<3),6<d?(D+=g[d],A[A.length]=x,7===d&&(y[e]+=1)):(E+=g[d],A[A.length]=x,1===d&&(z[e]+=1)));d=A.length;for(x=0;x<d;x++)h=A[x],f=a[h],e=h>>3,e=h-(e<<3),1===f?(f=-100-n[h],z[e-1]||z[e+1]||(f+=35),1!==z[e]&&(f+=20)):7===f?(f=100+m[h],y[e-1]||y[e+1]||(f-=35),1!==y[e]&&
(f-=20)):f=2===f?-300-k[h]:8===f?300+l[h]:3===f?-300-u[h]:9===f?300+b[h]:4===f?0===z[e]?0===y[e]?-542:-522:-500:10===f?0===y[e]?0===z[e]?542:522:500:6===f?22<D?-300-v[h]:-300-w[h]:12===f?22<E?300+q[h]:300+p[h]:g[f],c+=f;return c}function f(a,b,e){h+=1;var g=[],k=0,l=game.moveGen(a),n=l.length,m,p,q;if(3===b&&(m=makePositionString(a),d[m])){a=0;b=d[m][0][0];for(e=~~(100*Math.random());b<e;)a+=1,b+=d[m][a][0];return[d[m][a][1],d[m][a][2]]}if(0!==n){for(var u=0;u<n;u+=1){q=l[u];p=!1;if(e&&0!==q[1])p=
!0;else if(e)continue;m=fastCloneNode(a);m=doMove(m,q);p=b?f(m,b-1,!1):p?f(m,b,q[1]):c(m.position);!1===p&&(p=c(m.position));0===g.length?(g=[u],k=p):!1===m.move&&p>k||!0===m.move&&p<k?(k=p,g=[u]):k!==p&&g.length||g.push(u)}if(0===g.length)return!1}else return 3===b?null:a.move?kingInCheck(a,!0)?-9999:0:kingInCheck(a,!1)?9999:0;if(3!==b)return k;"undefined"===typeof l[g[0]]&&console.log(l,g);return l[g[0]]}var e=(new Date).getTime(),g=[0,-100,-300,-310,-500,-900,0,100,300,310,500,900,0],h=0,d={},
m=[0,0,0,0,0,0,0,0,50,50,50,50,50,50,50,50,10,10,20,30,30,20,10,10,5,5,10,25,25,10,5,5,0,0,0,20,20,0,0,0,5,-5,-10,0,0,-10,-5,5,5,10,10,-20,-20,10,10,5,0,0,0,0,0,0,0,0],n=[0,0,0,0,0,0,0,0,5,10,10,-20,-20,10,10,5,5,-5,-10,0,0,-10,-5,5,0,0,0,20,20,0,0,0,5,5,10,25,25,10,5,5,10,10,20,30,30,20,10,10,50,50,50,50,50,50,50,50,0,0,0,0,0,0,0,0],l=[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,0,0,0,-20,-40,-30,0,10,15,15,10,0,-30,-30,5,15,20,20,15,5,-30,-30,0,15,20,20,15,0,-30,-30,5,10,15,15,10,5,-30,-40,-20,0,
5,5,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50],k=[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,0,0,0,-20,-40,-30,5,10,15,15,10,5,-30,-30,0,15,20,20,15,0,-30,-30,5,15,20,20,15,5,-30,-30,0,10,15,15,10,0,-30,-40,-20,0,5,5,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50],b=[5,5,-10,-10,-10,-10,5,5,5,0,0,0,0,0,0,5,-10,0,5,10,10,5,0,-10,-15,5,5,10,10,5,5,-10,-15,0,10,10,10,10,0,-10,-10,10,10,10,10,10,10,-10,5,15,0,-5,-5,0,15,5,5,5,-15,-20,-20,-15,5,5],u=[5,5,-15,-20,-20,-15,5,5,5,15,0,-5,-5,0,15,5,-10,10,10,10,
10,10,10,-10,-15,0,10,10,10,10,0,-10,-15,5,5,10,10,5,5,-10,-10,0,5,10,10,5,0,-10,5,0,0,0,0,0,0,5,5,5,-10,-10,-10,-10,5,5],q=[-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-20,-30,-30,-40,-40,-30,-30,-20,-10,-20,-20,-20,-20,-20,-20,-10,20,20,0,0,0,0,10,15,20,30,10,0,0,10,30,20],v=[20,30,10,0,0,10,30,20,15,10,0,0,0,0,10,15,-10,-20,-20,-20,-20,-20,-20,-10,-20,-30,-30,-40,-40,-30,-30,-20,-30,-40,-40,-50,-50,-40,-40,-30,
-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30],p=[-50,-40,-30,-20,-20,-30,-40,-50,-30,-20,-10,0,0,-10,-20,-30,-30,-10,20,30,30,20,-10,-30,-30,-10,30,40,40,30,-10,-30,-30,-10,30,40,40,30,-10,-30,-30,-10,20,30,30,20,-10,-30,-30,-30,0,0,0,0,-30,-30,-50,-30,-30,-30,-30,-30,-30,-50],w=[-50,-30,-30,-30,-30,-30,-30,-50,-30,-30,0,0,0,0,-30,-30,-30,-10,20,30,30,20,-10,-30,-30,-10,30,40,40,30,-10,-30,-30,-10,30,40,40,30,-10,-30,-30,-10,20,30,30,20,-10,-30,-30,
-20,-10,0,0,-10,-20,-30,-50,-40,-30,-20,-20,-30,-40,-50];d.prnbqkberppeeppppeeepeneeeeeeeeeeeeeNPeeeeeNeeeeePPPeePPPReBQKBeRb1111=[[50,8,16],[30,14,22],[20,1,18]];d.prnbqkberppeeppppeeepeneeeeeeeeeeeeeNPeeeeeeeeeeePPPeePPPRNBQKBeRw1111=[[100,57,42]];d.prnbqkbnrppeeppppeeepeeeeeeeeeeeeeeeNPeeeeeeeeeeePPPeePPPRNBQKBeRb1111=[[100,6,21]];d.prnbqkbnrppeeppppeeepeeeeeeeeeeeeeeepPeeeeeeeeNeePPPeePPPRNBQKBeRw1111=[[100,45,35]];d.prnbqkberppppppppeeeeeneeeeeeeeeeeePeeeeeeeNeeeeePPePPPPPReBQKBNRb1111=[[50,
14,22],[30,12,20],[20,10,26]];d.prnbqkberppppppppeeeeeneeeeeeeeeeeePeeeeeeeeeeeeePPePPPPPRNBQKBNRw1111=[[70,57,42],[15,54,46],[15,62,45]];d.prnbqkbnrppppppppeeeeeeeeeeeeeeeeeePeeeeeeeeeeeeePPePPPPPRNBQKBNRb1111=[[40,6,21],[35,12,28],[15,12,20],[10,10,26]];d.prnbqkbnrppepepppeeeepeeeeeeeeeeeeeeNPeeeeeeeeeeePPPeePPPRNBQKBeRb1111=[[40,8,16],[35,6,21],[25,1,18]];d.prnbqkbnrppepepppeeeepeeeeeeeeeeeeeepPeeeeeeeeNeePPPeePPPRNBQKBeRw1111=[[100,45,35]];d.prnbqkbnrppepepppeeeepeeeeepeeeeeeeePPeeeeeeeeNeePPPeePPPRNBQKBeRb1111=
[[100,26,35]];d.prnbqkbnrppepepppeeeepeeeeepeeeeeeeeePeeeeeeeeNeePPPPePPPRNBQKBeRw1111=[[80,51,35],[7,50,42],[7,57,42],[6,51,43]];d.prnbqkbnrppeeepppeepepeeeeeepeeeeeePPeeeeeeNeeNeePPeePPPPReBQKBeRb1111=[[40,6,21],[40,27,34],[20,13,29]];d.prnbqkbnrppeeepppeepepeeeeeepeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRw1111=[[35,62,45],[35,52,44],[15,34,27],[15,52,36]];d.prnbqkberpppeepppeeeepneeeeepeeBeeePPeeeeeeNeeeeePPeePPPPReeQKBNRb1111=[[65,5,12],[35,1,11]];d.prnbqkberpppeepppeeeepneeeeepeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRw1111=
[[55,58,30],[25,34,27],[20,62,45]];d.prnbqkbnrpppeepppeeeepeeeeeepeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRb1111=[[65,6,21],[35,10,18]];d.prnbqkbnrpppeepppeeeepeeeeeepeeeeeePPeeeeeeeeeeeePPeePPPPRNBQKBNRw1111=[[65,57,42],[35,62,45]];d.prnbekbnrpppeppppeeeeeeeeqeeeeeeeeeePeeeeeeNeeeeePPPeePPPReBQKBNRb1111=[[65,6,21],[35,10,18]];d.prnbekbnrpppeppppeeeeeeeeqeeeeeeeeeeeeeeeeeNeeeeePPPPePPPReBQKBNRw1111=[[75,51,35],[15,62,45],[10,61,34]];d.prnbekbnrpppeppppeeeeeeeeeeeqeeeeeeeeeeeeeeNeeeeePPPPePPPReBQKBNRb1111=
[[100,27,24]];d.prnbekbnrpppeppppeeeeeeeeeeeqeeeeeeeeeeeeeeeeeeeePPPPePPPRNBQKBNRw1111=[[100,57,42]];d.prnbqkbnrpppeppppeeeeeeeeeeePeeeeeeeeeeeeeeeeeeeePPPPePPPRNBQKBNRb1111=[[60,3,27],[40,6,21]];d.prnbqkbnrpppeppppeeeeeeeeeeepeeeeeeeePeeeeeeeeeeePPPPePPPRNBQKBNRw1111=[[100,36,27]];d.prnbqkeerpppeppbpeeepenpeeeeeeeeeeePPPeeeeeNeeNeePPeeePPPReBQKBeRb1111=[[100,4,6]];d.prnbqkeerpppeppbpeeepenpeeeeeeeeeeePPPeeeeeNeeeeePPeeePPPReBQKBNRw1111=[[40,62,45],[35,53,45],[25,61,52]];d.prnbqkeerppppppbpeeeeenpeeeeeeeeeeePPPeeeeeNeeeeePPeeePPPReBQKBNRb1111=
[[85,11,19],[15,4,6]];d.prnbqkeerppppppbpeeeeenpeeeeeeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRw1111=[[85,52,36],[15,62,45]];d.prnbqkberppppppepeeeeenpeeeeeeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRb1111=[[75,5,14],[25,11,27]];d.prnbqkberppppppepeeeeenpeeeeeeeeeeePPeeeeeeeeeeeePPeePPPPRNBQKBNRw1111=[[100,57,42]];d.prnbqkberppppppppeeeeeneeeeeeeeeeeePeeeeeeeeeeNeePPePPPPPRNBQKBeRb1111=[[45,14,22],[35,12,20],[20,10,26]];d.prnbqkberppppppppeeeeeneeeeeeeeeeeeeeeeeeeeeeeNeePPPPPPPPRNBQKBeRw1111=[[60,50,34],[30,54,
46],[10,51,35]];d.prnbqkbnrppppppppeeeeeeeeeeeeeeeeeeeeeeeeeeeeeNeePPPPPPPPRNBQKBeRb1111=[[60,6,21],[30,11,27],[10,10,26]];d.prnbqkbnrpppeepppeeeepeeeeeepeeeeeeePPeeeeeeeeeeePPPeePPPRNBQKBNRw1111=[[40,57,42],[35,57,51],[15,36,28],[10,36,27]];d.prnbqkbnrppppepppeeeepeeeeeeeeeeeeeePPeeeeeeeeeeePPPeePPPRNBQKBNRb1111=[[100,11,27]];d.prnbqkbnrppppepppeeeepeeeeeeeeeeeeeeePeeeeeeeeeeePPPPePPPRNBQKBNRw1111=[[100,51,35]];d.prnbqkbnrpppeppppeeeeeeeeeeepeeeeeeePeeeeeeeeeeeePPPePPPPRNBQKBNRw1111=[[65,50,34],
[35,62,45]];d.prebqkeereepebppppenpeneeepeepeeeeeeePeeeeBeeeNeePPPPePPPRNBQReKew0011=[[100,50,42]];d.prebqkeereeppbppppeneeneeepeepeeeeeeePeeeeBeeeNeePPPPePPPRNBQReKeb0011=[[60,11,19],[40,60,62]];d.prebqkeereeppbppppeneeneeepeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQReKew0011=[[100,32,41]];d.prebqkeereeppbppppeneeneeepeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQReKew0011=[[100,9,25]];d.prebqkeerepppbppppeneeneeeeeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQeRKew0011=[[100,61,60]];d.prebqkberepppeppppeneeneeeeeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQeRKeb0011=
[[80,5,12],[20,9,25]];d.prebqkberepppeppppeneeneeeeeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQKeeRw1111=[[100,60,62]];d.prebqkbnrepppeppppeneeeeeeeeepeeeBeeePeeeeeeeeNeePPPPePPPRNBQKeeRb1111=[[90,6,21],[10,11,19]];d.prebqkberpppeepppeenpeneeeBeepeeeeeeePeeeeePPeNeePPeeePPPRNBQKeeRb1111=[[35,14,22],[33,5,12],[32,2,11]];d.prebqkberpppeepppeenpeneeeBeepeeeeeeePeeeeeePeNeePPPeePPPRNBQKeeRw1111=[[55,50,42],[45,60,62]];d.prebqkberppppepppeeneeneeeBeepeeeeeeePeeeeeePeNeePPPeePPPRNBQKeeRb1111=[[50,11,19],[50,5,26]];
d.prebqkberppppepppeeneeneeeBeepeeeeeeePeeeeeeeeNeePPPPePPPRNBQKeeRw1111=[[75,60,62],[25,51,43]];d.prnbqkbnrpppeepppeeeepeeeeeepeeeeeePPeeeeeeNeeeeePPeePPPPReBQKBNRb1111=[[70,6,21],[30,10,18]];d.prnbqkbnrpppeppppeeeeeeeeeeeeeeeeeepPeeeeeeeeeeeePPeePPPPRNBQKBNRw1111=[[70,57,42],[30,62,45]];d.prnbqkbnrpppeppppeeeeeeeeeeepeeeeeePPeeeeeeeeeeeePPeePPPPRNBQKBNRb1111=[[40,12,20],[40,10,18],[20,27,34]];d.prebqkbnrppppepppeeneeeeeeeeeeeeeeeepPeeeeeeeeNeePPPeePPPRNBQKBeRw1111=[[100,45,35]];d.prebqkeerppppepppeeneeneeeebepeeeeeBPPeeeeePeeNeePPeeePPPRNBQKeeRb1111=
[[100,28,35]];d.prebqkeerppppepppeeneeneeeebepeeeeeBePeeeeePeeNeePPePePPPRNBQKeeRw1111=[[60,51,35],[40,51,43]];d.prebqkenrppppepppeeneeeeeeebepeeeeeBePeeeeePeeNeePPePePPPRNBQKeeRb1111=[[100,6,21]];d.prebqkenrppppepppeeneeeeeeebepeeeeeBePeeeeeeeeNeePPPPePPPRNBQKeeRw1111=[[50,50,42],[20,51,43],[15,60,62],[15,57,42]];d.prebqkbnrppppepppeeneeeeeeeeepeeeeeBePeeeeeeeeNeePPPPePPPRNBQKeeRb1111=[[60,5,26],[40,6,21]];d.prebqkbnrppppepppeeneeeeeeeeepeeeeeePPeeeeeeeeNeePPPeePPPRNBQKBeRb1111=[[100,28,35]];d.prnbqkberppppppppeeeeeneeeeeeeeeeeePPeeeeeeeeeeeePPeePPPPRNBQKBNRb1111=
[[45,12,20],[35,14,22],[20,10,26]];d.prnbqkberppppppppeeeeeneeeeeeeeeeeeePeeeeeeeeeeeePPPePPPPRNBQKBNRw1111=[[60,50,34],[40,62,45]];d.prnbqkbnrppppppppeeeeeeeeeeeeeeeeeeePeeeeeeeeeeeePPPePPPPRNBQKBNRb1111=[[60,6,21],[40,11,27]];d.prebqkbnrppepppppeeneeeeeeepeeeeeeeePPeeeeeeeeNeePPPeePPPRNBQKBeRb1111=[[100,26,35]];d.prnbqkbnrppeeppppeeepeeeeeepeeeeeeeePPeeeeeeeeNeePPPeePPPRNBQKBeRb1111=[[100,26,35]];d.prnbqkbnrppeeppppeeepeeeeeepeeeeeeeeePeeeeeeeeNeePPPPePPPRNBQKBeRw1111=[[90,51,35],[10,61,25]];d.prnbqkbnrppepppppeeeeeeeeeepeeeeeeeeePeeeeeeeeNeePPPPePPPRNBQKBeRb1111=
[[45,11,19],[40,1,18],[15,12,20]];d.prnbqkbnrppepppppeeeeeeeeeepeeeeeeeeePeeeeeeeeeeePPPPePPPRNBQKBNRw1111=[[90,62,45],[5,57,42],[3,50,42],[2,51,35]];d.prebqkbnrepppeppppeneeeeeeBeepeeeeeeePeeeeeeeeNeePPPPePPPRNBQKeeRw1111=[[86,25,32],[14,25,18]];d.prnbqkbnrppppppppeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeePPPPPPPPRNBQKBNRw1111=[[45,52,36],[40,51,35],[10,62,45],[8,50,34],[5,54,46],[2,49,41]];d.prnbqkbnrppppppppeeeeeeeeeeeeeeeeeeeePeeeeeeeeeeePPPPePPPRNBQKBNRb1111=[[50,10,26],[35,12,28],[9,12,20],[4,10,18],
[2,11,19]];d.prnbqkbnrppppepppeeeeeeeeeeeepeeeeeeePeeeeeeeeeeePPPPePPPRNBQKBNRw1111=[[88,62,45],[6,57,42],[6,53,37]];d.prnbqkbnrppppepppeeeeeeeeeeeepeeeeeeePeeeeeeeeNeePPPPePPPRNBQKBeRb1111=[[95,1,18],[5,6,21]];d.prebqkbnrppppepppeeneeeeeeeeepeeeeeeePeeeeeeeeNeePPPPePPPRNBQKBeRw1111=[[70,61,25],[20,61,34],[10,51,35]];d.prebqkbnrppppepppeeneeeeeeBeepeeeeeeePeeeeeeeeNeePPPPePPPRNBQKeeRb1111=[[86,8,16],[10,6,21],[4,13,29]];a=f(a,3,!1);e=(new Date).getTime()-e;console.log(this.name,"nodes searched: "+
h,"time taken: "+e+"ms","nodes/second: "+~~(h/(e/1E3)));return a}};
