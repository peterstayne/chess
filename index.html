<!doctype html>
<html>
<head>
<title>Chess!</title>

<style type="text/css">
* { 
	border: 0;
	margin: 0;
	padding: 0;
	font-family: arial, helvetica, verdana, sans-serif;
	font-size: 14px;
}
.board {
	width: 500px;
	height: 500px;
}	
.square {
	width: 60px;
	height: 60px;
	border: 1px solid #000;
	float: left;
	text-align: center;
	font-size: 30px;
	font-weight: 800;
}
.black {
	background-color: #aaffaa;
}
input[type=text] {
	border: 1px solid #000;
}
</style>

</head>
<body>
<div id="board" class="board">

</div> 
<div class="controlpanel">
	<label for="fen">FEN</label>
	<input type="text" size="80" id="fen" class="fen" value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1" />
	<input type="button" value="submit" id="submitfen" />
</div>


<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

<script>
var pieces = {
	symbols: {
		p: 1,
		n: 2,
		b: 3,
		r: 4,
		q: 5,
		k: 6,
		P: 7,
		N: 8,
		B: 9,
		R: 10,
		Q: 11,
		K: 12
	}, 
	numbers: [' ', 'p', 'n', 'b', 'r', 'q', 'k', 'P', 'N', 'B', 'R', 'Q', 'K']
};
var node = function() {
	this.position = [];
	this.castle = {
		k: true,
		q: true,
		K: true,
		Q: true
	};
	this.turn = true;
	this.drawClock = 0;
	this.fullMove = 1;
	this.score = 0;
};


var board = {
	parsefen: function(fen) {
		var returnNode = new node();
		$(".square").text(' ');
		var fenparts = fen.split(" ");
		positions = fenparts[0].split("/");
		var row = 0;
		var col = 0;
		var mark = 0;
		for(var i in positions) {
			col = 0;
			for(var p = 0; p < positions[i].length; p++) {
				mark = ((row * 8) + col);
				this_position = positions[i][p];
				this_position_code = this_position.charCodeAt();
				if(this_position_code > 47 && this_position_code < 58) {
					for(var r = 0; r < +(this_position); r++) {
						returnNode.position[mark + r] = 0;
					}
					col += (+this_position);
				} else {
					returnNode.position[mark] = pieces.symbols[this_position];
					col++;
				}
			}
			row++;
		}
		return returnNode;
	}
};

$(document).ready(function(){
	var html = '';
	var b = true;
	for(var r = 0; r < 64; r++) {
		html += '<div id="square' + r + '" class="square ' + (b?'white':'black') + '"> </div>';
		if((r+1) / 8 != ~~((r+1) / 8)) b = !b;
	}
	$("#board").html(html);
	html = '';

	$("#submitfen").click(function() {
		thisnode = board.parsefen($("#fen").val());
		thisposition = thisnode.position;
		console.log(thisposition);
		var mark = 64;
		while(mark--) {
			console.log(mark, thisposition[mark], pieces.numbers[thisposition[mark]]);
			$(".square").eq(mark).text(pieces.numbers[thisposition[mark]]);
		}
	});
});

</script>

</body>
</html>